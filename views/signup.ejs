
<!DOCTYPE html>
<html>
    <head>
        <title>회원가입</title>
        <!--로그인 폼 출처 :
        https://rpbloggers.com/free-download-html-css-login-form/#google_vignette -->
        <link
            rel="stylesheet"
            type="text/css"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
        <!-- <script
        src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="form sign-in-container">

                <h1>회원가입</h1>
                <!-- 이메일 정규식 -->
                <!-- var regEmail =
                /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;
                -->
                <input type="email" placeholder="이메일" id="id" name="id" class="id">
                <button id="checkbtn" onclick="checkId()">중복확인</button>
                <div class="emailcheck"></div>
                <form action="/kg/signUpPro" method="post">
                  <input type="hidden" id="hidden_id" name="hiddenId">
                    <input
                        type="password"
                        placeholder="Password"
                        id="password"
                        name="password"
                        class="pw">
                    <div class="passwordcheck"></div>
                    <!-- var reg = "^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$";
                    비밀번호 -->
                    <input
                        type="password"
                        placeholder="Password Check"
                        id="password_a"
                        name="cpassword"
                        class="pw">
                    <div class="passwordre"></div>
                    <input type="text" placeholder="이름" id="name" name="name" class="name">
                    <div class="namecheck"></div>

                    <input type="date" placeholder="생일" id="birth" name="birth" class="birth">

                    <!-- var regPhone = /^01([0|1|6|7|8|9])-?([0-9]{3,4})-?([0-9]{4})$/; 휴대폰 번호 정규식
                    (-상관X) -->
                    <input
                        type="text"
                        placeholder="연락처(-포함 가능)"
                        id="phoneNum"
                        name="phoneNum"
                        class="phoneNum">
                    <div class="phonecheck"></div>
                    <button
                        type="submit"
                        class="btn"
                        onclick="console.log('ok') "
                        disabled="disabled">회원가입</button>
                    <!-- <input class="btn" type="button" value="회원가입" disabled="disabled"> -->
                </form>
            </div>
            <div class="overlay-container">
                <div class="overlay">
                    <div class="overlay-panel overlay-right">
                        <% if (data=='noCookie'){ %>
                            <h1>로그인</h1>
                            <p>이미 계정을 갖고 계신가요?</p>
                            <button class="signup_btn" onclick="window.location='/kg/login'">로그인</button>
                            <br/>
                            <button class="signup_btn" onclick="window.location='/'">홈</button>
                        <% } else { %>
                            <form action="/kg/logout" method="get">
                                <button type="submit">logout</button>
                            </form>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // document.querySelector('#checkbtn').onclick() = function(){   let check =
            // $('#id').val();   $.ajax({     url : "/",     type : "POST",     data :
            // {id:check},   }) } document.querySelector('#checkbtn').onclick() = ()=>{
            // let check = $('#id').val();     $.ajax({       url : "/",       type :
            // "POST",       data : { id: check },     }) }
            let idAble = 0;
            let _iduse = document.querySelector('#id');
            function checkId() {
                let check = $('#id').val();

                $.ajax({
                    url: "/", // /abc라면 메인 홈페이지 / 에서 보낸 값은 /abc 경로에 담기는 개념
                    type: "POST",
                    data: {
                        id: check
                    },
                    success: function (data) {
                        if (data == 'usable') {
                            if (confirm(
                                '사용 가능합니다. ' + check + ' 사용 하시겠습니까? \n예 누를 시 수정 불가'
                            ) == true) {
                                _iduse.readOnly = true;
                                document.querySelector('#hidden_id').setAttribute('value',check);
                            }
                            idAble = 1;
                        } else if (data == 'disusable') {
                            alert('사용 불가');
                            idAble = 0;
                            document
                                .querySelector('.btn')
                                .disabled = true;
                        } else {
                            alert('잘못된 요청입니다.');
                            idAble = 0;
                        }
                    }
                })

            }

            let a = 0;
            let b = 0;
            let c = 0;
            let d = 0;
            let e = 0;
            let sum_ = a + b + c + d + e;
            document
                .querySelector('#id')
                .onkeyup = function () {
                    let id = this.value;
                    let idreg = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/g;
                    if (idreg.test(id)) {
                        document
                            .querySelector('.emailcheck')
                            .innerHTML = "사용 가능"
                        a = 1;
                        console.log(a)
                    } else if (id == "") {
                        document
                            .querySelector('.emailcheck')
                            .innerHTML = ""
                        a = 0;
                        console.log(a)
                    } else {
                        document
                            .querySelector('.emailcheck')
                            .innerHTML = "이메일을 입력하세요 ex)rudghks0981@gmail.com"
                        a = 0;
                        console.log(a)
                    }
                }
            document
                .querySelector('#password')
                .onkeyup = function () {
                    let password = this.value;
                    let passwordreg = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/g;
                    if (passwordreg.test(password)) {
                        document
                            .querySelector('.passwordcheck')
                            .innerHTML = "사용 가능"
                        b = 1;
                        console.log(b)
                    } else if (password == "") {
                        document
                            .querySelector('.passwordcheck')
                            .innerHTML = ""
                        b = 0;
                        console.log(b)
                    } else {
                        document
                            .querySelector('.passwordcheck')
                            .innerHTML = "1개이상의 특수문자 대문자 소문자 숫자를 입력하세요"
                        b = 0;
                        console.log(b)
                    }
                }
            document
                .querySelector('#password_a')
                .onkeyup = function () {
                    let password_a = this.value;
                    if (password_a == password.value) {
                        document
                            .querySelector('.passwordre')
                            .innerHTML = "동일합니다."
                        c = 1;
                        console.log(c)
                    } else if (password_a == "") {
                        document
                            .querySelector('.passwordre')
                            .innerHTML = ""
                        c = 0;
                        console.log(c)
                    } else {
                        document
                            .querySelector('.passwordre')
                            .innerHTML = "패스워드가 동일하지 않습니다."
                        c = 0;
                        console.log(c)
                    }
                }
            document
                .querySelector('#name')
                .onkeyup = function () {
                    let name = this.value;
                    let namereg = /^[가-힣a-zA-Z]{2,}$/g;
                    if (namereg.test(name)) {
                        document
                            .querySelector('.namecheck')
                            .innerHTML = ""
                        d = 1;
                        console.log(d)
                    } else if (name == "") {
                        document
                            .querySelector('.namecheck')
                            .innerHTML = ""
                        d = 0;
                        console.log(d);
                    } else {
                        document
                            .querySelector('.namecheck')
                            .innerHTML = "두글자이상 한글 또는 영문을 입력하세요"
                        d = 0;
                        console.log(d);
                    }
                }
            document
                .querySelector('#phoneNum')
                .onkeyup = function () {
                    let phoneNum = this.value;
                    let phonereg = /^01([0|1|6|7|8|9])-?([0-9]{3,4})-?([0-9]{4})$/g;
                    // let phonereg = /^\d{3}-\d{3,4}-\d{4}$/;
                    if (phonereg.test(phoneNum) || phoneNum == "") {
                        document
                            .querySelector('.phonecheck')
                            .innerHTML = ""
                        e = 1;
                        console.log(e)
                    } else if (phoneNum == "") {
                        document
                            .querySelector('.phonecheck')
                            .innerHTML = ""
                        e = 0;
                        console.log(e)
                    } else {
                        document
                            .querySelector('.phonecheck')
                            .innerHTML = "숫자 및 -만 입력 가능합니다."
                        e = 0;
                        console.log(e)
                    }
                }
            console.log(sum_)
            window.onkeyup = function () {
                console.log(idAble)
                if (a == 1 && b == 1 && c == 1 && d == 1 && e == 1 && idAble === 1) {

                    document
                        .querySelector('.btn')
                        .disabled = false;
                } else {
                    document
                        .querySelector('.btn')
                        .disabled = true;
                }
            }
            document
                .querySelector('.btn')
                .onclick = function () {
                    alert("회원 가입을 축하합니다.")
                    window
                        .location
                        .reload();
                }
            // 내일 물어볼 것 : 패스워드 정규식은 왜 전역변수로 선언시 에러가 발생하는가 여기서 콜백을 써서 동기처리로 하는 방법
        </script>

    </body>
</html>